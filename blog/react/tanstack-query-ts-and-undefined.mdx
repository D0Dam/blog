---
date: 2024-04-08
authors: d0dam
title: 'tanstack query + tsì—ì„œ undefined ë§¤ê°œë³€ìˆ˜ ì—„ê²©í•˜ê²Œ ì²˜ë¦¬í•˜ê¸°'
description: 'tanstack queryì™€ typescriptë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ì¢…ì¢… undefined ì¼ ìˆ˜ ìˆëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ ë„˜ê¸°ê¸°ë„ í•©ë‹ˆë‹¤. ì–´ë–¤ ë°©ë²•ìœ¼ë¡œ undefinedë¥¼ ì²˜ë¦¬í•´ ì¤„ ìˆ˜ ìˆì„ì§€ ê³ ë¯¼í•´ë³´ì•˜ìŠµë‹ˆë‹¤.'
keywords: ['react', 'tanstack query', 'typescript']
tags:
  - react
  - tanstack query
  - typescript
---

tanstack queryì™€ typeScriptë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ì¢…ì¢… undefined ì¼ ìˆ˜ ìˆëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ ë„˜ê¸°ê¸°ë„ í•©ë‹ˆë‹¤. ì–´ë–¤ ë°©ë²•ìœ¼ë¡œ undefinedë¥¼ ì²˜ë¦¬í•´ ì¤„ ìˆ˜ ìˆì„ì§€ ê³ ë¯¼í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

<!--truncate-->

## ë“¤ì–´ê°€ê¸° ì•ì„œ

ì´ ê¸€ì€ tanstack query v5ì™€ typescript v5, react v18 ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

## ìƒê°í•˜ê²Œ ëœ ê³„ê¸°

urlì˜ pathì— ê³ ìœ í•œ idë¥¼ í¬í•¨ì‹œí‚¤ëŠ”, ìƒê°ë³´ë‹¤ í”í•œ ê²½ìš°ì˜€ìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì—¬ëŸ¬ courseì— ê°ê° ê³ ìœ ì˜ idê°€ ìˆë‹¤ê³  í•˜ë©´ `https://example.com/course/${id}` ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ urlì„ ë‚˜ëˆ„ì–´ ì¤„ ìˆ˜ ìˆì£ .
ì´ ë•Œ useParamsë¥¼ ì‚¬ìš©í•´ idê°’ì„ urlì—ì„œ ê°€ì ¸ì™€ apië¥¼ ìš”ì²­í•˜ëŠ” ìƒí™©ì´ì—ˆìŠµë‹ˆë‹¤.

```tsx title="CourseDetailPage.tsx"
const getCourseDetail = async (id: number) => {
  const res = await apiClient.get<CourseDetailResponse>(`/course/${id}`);

  return res.data;
};

function CourseDetailPage() {
  const { id } = useParams();
  const courseId = Number(id);
  const { data } = useSuspenseQuery({
    queryKey: ['course', courseId],
    queryFn: () => getCourseDetail(courseId, params),
  });

  return <div>{data.content}</div>;
}
```

ì´ ê²½ìš° ë¬¸ì œê°€ ë˜ëŠ” ë¶€ë¶„ì€ ë°”ë¡œ id ê°’ì˜ type ì…ë‹ˆë‹¤.

```
const { id } = useParams(); // const id: string | undefined
```

idê°€ ì—†ëŠ” ê²½ìš°ë„ ì¡´ì¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ì£ .
í•˜ì§€ë§Œ api ë¡œì§ ìì²´ë¡œëŠ” idê°€ í•„ìˆ˜ê°’ì…ë‹ˆë‹¤. ê·¸ë˜ì„œ idê°€ undefinedì¸ ê²½ìš°ë¥¼ ë°°ì œì‹œí‚¤ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤.

ë¬¸ë“, ì „ì—ëŠ” ì´ëŸ° ìƒí™©ì´ ë°œìƒí•  ë•Œ ë§ˆë‹¤ ì†ì´ ê°€ëŠ”ëŒ€ë¡œ ì½”ë“œë¥¼ ì§¯ë˜ ê¸°ì–µì´ ë– ì˜¬ëìŠµë‹ˆë‹¤.
ê·¸ ì½”ë“œë¥¼ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‚¬ìš©í•˜ë ¤ê³ í•  ë•Œ êµ‰ì¥íˆ ë¶ˆí¸í•˜ë”êµ°ìš”.
ê·¸ë˜ì„œ ì´ë²ˆ ê¸°íšŒì— ì´ ìƒí™©ì„ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ë°©ë²•ì„ ê³ ë¯¼í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.

## ë°©ë²• ì°¾ê¸°

ìš°ì„  idê°€ undefinedì¸ ê²½ìš° api í•¨ìˆ˜ í˜¸ì¶œì„ ë§‰ì•„ì•¼í•©ë‹ˆë‹¤.

ì´ ë•Œ ê°€ì¥ í”í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ tanstack queryì˜ [`enabled`](https://tanstack.com/query/v5/docs/framework/react/guides/disabling-queries#lazy-queries) ì˜µì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
ì´ê±¸ í™œìš©í•´ ë°ì´í„°ë¥¼ lazyí•˜ê²Œ ë°›ì„ ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆì£ .

```tsx title="enabled ì‚¬ìš© ì˜ˆì‹œ"
function CourseDetailPage() {
  const { id } = useParams();
  const courseId = Number(id);
  const { data } = useSuspenseQuery({
    queryKey: ['course', courseId],
    queryFn: () => getCourseDetail(courseId),
    //highlight-next-line
    enabled: !!courseId,
  });

  return <div>{data.content}</div>;
}
```

ì´ì œ idê°€ falsyí•œ ê°’ì„ ê°€ì§€ê²Œ ëœ ë™ì•ˆì—ëŠ” `useSuspenseQuery`ê°€ ë™ì‘í•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì´ ê²½ìš° idì˜ íƒ€ì… ìì²´ëŠ” ë³€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ undefined íƒ€ì…ì„ ì–´ë–»ê²Œ ê±¸ëŸ¬ì¤„ì§€ ê³ ë¯¼í•´ë³´ì•„ì•¼ í•©ë‹ˆë‹¤.

### api í•¨ìˆ˜ì— idì˜ íƒ€ì…ì„ undefinedë„ ë°›ëŠ”ë‹¤.

ê·¸ë ‡ë‹¤ë©´ api í•¨ìˆ˜ì— undefined ì²˜ë¦¬ ë¡œì§ì´ ë“¤ì–´ê°€ì•¼í•˜ê² ë„¤ìš”.

```ts title="getCourseDetail.ts"
const getCourseDetail = async (id: number | undefined) => {
  if (typeof id === 'undefined') {
    return Promise.reject(new Error('idê°€ undefinedì…ë‹ˆë‹¤.'));
  }

  const res = await apiClient.get<CourseDetailResponse>(`/course/${id}`);

  return res.data;
};
```

ì´ ê²½ìš°ë„ ê´œì°®ë‹¤ê³  ìƒê°í•˜ì§€ë§Œ ì´ í•¨ìˆ˜ì˜ ë³¸ë˜ ëª©ì ì„ ìƒê°í–ˆì„ë•ŒëŠ” `ì™„ì „ ì¢‹ë‹¤!` ë¼ê³  ë§í•˜ê¸° í˜ë“¤ì—ˆìŠµë‹ˆë‹¤.

ì œ ìƒê°ì„ ì ì–´ë³´ìë©´...

- `getCourseDetail`ì´ idê°€ undefinedì¸ ì¸ìë¥¼ ë°›ì§€ë§Œ, ì´ ê²½ìš° ì—ëŸ¬ê°€ ë‚œë‹¤ëŠ” ì ì´ ë¬˜ì—°í•©ë‹ˆë‹¤.
  - `getCourseDetail`ì˜ idê°€ undefinedë¥¼ ë°›ê² ë‹¤ê³  ì •ì˜í•œ í•¨ìˆ˜ë¼ë©´, idê°€ undefinedì¸ ê²½ìš°ì—ë„ apií˜¸ì¶œì´ ê°€ì•¼ ì§ê´€ì ìœ¼ë¡œ ì§œì—¬ì§„ í•¨ìˆ˜ë¼ê³  ìƒê°ì´ ë“­ë‹ˆë‹¤.

`getCourseDetail` í•¨ìˆ˜ ìì²´ì— ì§‘ì¤‘í•´ë´…ì‹œë‹¤.

`getCourseDetail` í•¨ìˆ˜ê°€ ê°€ì§€ëŠ” api urlì€ idê°€ undefinedì¸ ê²½ìš°ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.(`/course`ì¸ ê²½ìš°ê°€ ì—†ê±°ë‚˜ CourseDetailResponseê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì‘ë‹µì´ ì˜µë‹ˆë‹¤.)

ê·¸ë˜ì„œ `getCourseDetail` í•¨ìˆ˜ì˜ ì¸ìì¸ idëŠ” ë¬´ì¡°ê±´ ì¡´ì¬í•´ì•¼í•˜ë¯€ë¡œ undefinedë¥¼ ë°›ì„ ìˆ˜ ì—†ê²Œ ì„¤ê³„í•˜ëŠ” ê²ƒì´ ë§ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.
ì‹¤ì œë¡œ enabled ì˜µì…˜ì„ í†µí•´ idê°€ ì¡´ì¬í• ë•Œë§Œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³  ì‹¶ì–´í–ˆë‹¤ëŠ” ê²ƒì€ ì• ì´ˆì— api í•¨ìˆ˜ì˜ id ì¸ìë¡œ undefinedê°€ ì˜¤ëŠ”ê²ƒì„ í”¼í•˜ê³  ì‹¶ì—ˆë‹¤ëŠ” ì´ì•¼ê¸°ê°€ ì•„ë‹ê¹Œ í•©ë‹ˆë‹¤.

### api í•¨ìˆ˜ ì™¸ë¶€ì—ì„œ id íƒ€ì… ì¢íˆê¸°

ê·¸ëŸ¼ ì´ì œ ì™¸ë¶€ì—ì„œ id íƒ€ì…ì„ numberë¡œ ë„˜ê²¨ì£¼ê¸° ìœ„í•œ ì²˜ë¦¬ë¥¼ í•´ë´…ì‹œë‹¤.

```tsx title="CourseDetailPage.tsx"
function CourseDetailPage() {
  const { id } = useParams();
  const courseId = Number(id);
  const { data } = useSuspenseQuery({
    queryKey: ['course', courseId],
    //highlight-next-line
    queryFn: courseId ? () => getCourseDetail(courseId) : undefined,
    enabled: !!courseId,
  });

  return <div>{data.content}</div>;
}
```

ì´ë ‡ê²Œ í•˜ë©´ idê°€ ì¡´ì¬í•  ë•Œë§Œ queryFnì„ í™œì„±í™” ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ ê³¼ì •ì€ type levelì—ì„œ ë™ì‘í•˜ê²Œ ë  ê²ƒì´ê³ , queryFnì€ ì˜µì…”ë„í•˜ë¯€ë¡œ undefinedê°€ ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ê·¸ë§Œí¼ queryFn í•¨ìˆ˜ê°€ ë‹¤ë¥¸ ë°©í–¥ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•Šë„ë¡ í™•ì‹¤í•˜ê²Œ í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.

## skipToken

ì¢€ ë” type safe í•˜ê²Œ í•˜ê¸°ìœ„í•œ [`skipToken`](https://tanstack.com/query/v5/docs/framework/react/guides/disabling-queries#typesafe-disabling-of-queries-using-skiptoken)ì´ë¼ëŠ” ê²ƒì´ ì¡´ì¬í•©ë‹ˆë‹¤.
tanstack query v5ë¶€í„° ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
ì¿¼ë¦¬ë¥¼ lazyí•˜ê²Œ ë‚´ë ¤ì£¼ê¸° ìœ„í•œ `enabled: false`ì˜ ë™ì‘ì—ë„ íƒ€ì…ì´ ë”°ë¼ê°ˆ ìˆ˜ ìˆê²Œ í•  ìˆ˜ ìˆì£ .
ê·¸ë˜ì„œ `enabled` ì˜µì…˜ ì—†ì´ë„ ì›í•˜ëŠ” ë™ì‘ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

íƒ€ì…ì€ unique symbolë¡œ ë˜ì–´ìˆìŠµë‹ˆë‹¤.

```ts title="skipToken type"
declare const skipToken: unique symbol;
```

ì´ì œ ì‚¬ìš©í•´ë³¼ê¹Œìš”?

```tsx title="CourseDetailPage.tsx"
import { useSuspenseQuery, skipToken } from '@tanstack/react-query';

function CourseDetailPage() {
  const { id } = useParams();
  const courseId = id ? Number(id) : undefined;
  const { data } = useSuspenseQuery({
    queryKey: ['course', courseId],
    //highlight-next-line
    queryFn: courseId ? () => getCourseDetail(courseId) : skipToken,
  });

  return <div>{data.content}</div>;
}
```

## ë§ˆë¬´ë¦¬

skipTokenì„ í†µí•´ `unique symbol`ì„ ì‚¬ìš©í•œ ì˜ˆì‹œë„ ì´ë ‡ê²Œ í™•ì¸í•´ë³´ë‹ˆ ê°íšŒê°€ ìƒˆë¡­ë„¤ìš”!
ì›í•˜ëŠ”ëŒ€ë¡œ api í•¨ìˆ˜ë¥¼ ë³´ì „í•˜ê³  type safeí•˜ê²Œ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆê²Œ ë˜ì–´ì„œ ì¢‹ì•˜ìŠµë‹ˆë‹¤.ğŸ˜Š
